{% extends 'base.html' %}
{% block title %}Leaderboard{% endblock %}

{% block description %}Leaderboards on Inlayo{% endblock %}

{% block og_title %}Global Leaderboard | Inlayo{% endblock %}
{% block og_description %}Browse global player rankings and compete with the best osu! players on Inlayo{% endblock %}
{% block og_image %}https://{{ domain() }}/static/favicon/android-chrome-256x256.png{% endblock %}

{% block header %}
<script src="/static/js/asserts/vue.js"></script>
<script src="/static/js/asserts/vue-axios.js"></script>

<script>
  var mode = "{{ mode }}";
  var mods = "{{ mods }}";
  var sort = "{{ sort }}";
  var domain = "{{ domain() }}";
  var page = parseInt("{{ page }}");
</script>
{% endblock %}{% block content %}
<div id="app" :class="(load ? 'load' : '')" style="max-width: 1400px; margin: 0 auto; padding: 2rem 1rem;">
  <div class="card mb-5" style="overflow: hidden; padding: 0;">
    <div class="leaderboard-banner">
      <div class="leaderboard-banner-content">
        <h1 class="leaderboard-banner-title">Global Leaderboard</h1>
        <p class="leaderboard-banner-subtitle">Compete with the best players</p>
      </div>
    </div>
    <div style="padding: 1.5rem;">
      <div class="mode-selector">
        <button class="mode-btn" :class="{ 'active': mode === 'std' }" @click="LoadLeaderboard(sort, 'std', mods)">
          <i class="mode-icon mode-osu"></i><span> osu!</span>
        </button>
        <button class="mode-btn" :class="{ 'active': mode === 'taiko', 'disabled': mods === 'ap' }"
          @click="LoadLeaderboard(sort, 'taiko', mods)">
          <i class="mode-icon mode-taiko"></i><span> osu!taiko</span>
        </button>
        <button class="mode-btn" :class="{ 'active': mode === 'catch', 'disabled': mods === 'ap' }"
          @click="LoadLeaderboard(sort, 'catch', mods)">
          <i class="mode-icon mode-catch"></i><span> osu!catch</span>
        </button>
        <button class="mode-btn" :class="{ 'active': mode === 'mania', 'disabled': mods === 'ap' || mods === 'rx' }"
          @click="LoadLeaderboard(sort, 'mania', mods)">
          <i class="mode-icon mode-mania"></i><span> osu!mania</span>
        </button>
      </div>
    
      <div style="display: flex; justify-content: space-between; padding: 0 1rem 1rem; gap: 1rem; flex-wrap: wrap;">
        <div style="display: flex; gap: 0.5rem;">
          <button class="ui-button" :class="sort === 'pp' ? 'ui-button-pink' : 'ui-button-secondary'"
            @click="LoadLeaderboard('pp', mode, mods)">PP</button>
          <button class="ui-button" :class="sort === 'score' ? 'ui-button-pink' : 'ui-button-secondary'"
            @click="LoadLeaderboard('score', mode, mods)">Score</button>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button class="ui-button" :class="mods === 'vn' ? 'ui-button-pink' : 'ui-button-secondary'"
            @click="LoadLeaderboard(sort, mode, 'vn')">Vanilla</button>
          <button class="ui-button" :class="{ 'ui-button-pink': mods === 'rx', 'ui-button-secondary': mods !== 'rx', 'disabled': mode === 'mania' }"
            @click="LoadLeaderboard(sort, mode, 'rx')">Relax</button>
          <button class="ui-button"
            :class="{ 'ui-button-pink': mods === 'ap', 'ui-button-secondary': mods !== 'ap', 'disabled': mode === 'taiko' || mode === 'catch' || mode === 'mania' }"
            @click="LoadLeaderboard(sort, mode, 'ap')">Autopilot</button>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <div v-if="boards.length != undefined && boards.length != 0" class="leaderboard-table">
      <div class="leaderboard-header">
        <div>#</div>
        <div>Player</div>
        <div v-if="sort == 'pp' || sort == 'score'">
          <% (sort=='pp' ? "PP" : "Score" ) %>
        </div>
        <div>Accuracy</div>
        <div>Playcount</div>
        <div>Max Combo</div>
      </div>
      <a v-for="(user, index) in boards" :href="'/u/'+user.player_id+'?mode='+mode+'&mods='+mods" class="leaderboard-row">
        <div :class="['leaderboard-rank', page > 0 ? 'text-white' : '']">
          #<% (page * 50) + index + 1 %>
        </div>
        <div class="leaderboard-player">
          <div class="leaderboard-flag"
            :style="'background-image: url(/static/images/flags/' + user.country.toUpperCase() + '.png)'"
            :title="flags[user.country.toUpperCase()]">
          </div>
          <div class="leaderboard-avatar"
            :style="'background-image: url(https://a.{{ domain() }}/' + user.player_id + ')'"></div>
          <div class="leaderboard-name">
            <% user.clan_tag ? `[${user.clan_tag}] ${user.name}` : user.name %>
          </div>
        </div>
        <div v-if="sort == 'pp' || sort == 'score'">
          <% (sort=='pp' ? user.pp+'pp' : scoreFormat(user.rscore) ) %>
        </div>
        <div>
          <% user.acc.toFixed(2) %>%
        </div>
        <div>
          <% addCommas(user.plays) %>
        </div>
        <div>
          <% addCommas(user.max_combo) %>
        </div>
      </a>
    </div>
    <div v-else class="empty-state">
      <div class="empty-state-icon">
        <i class="fas fa-users"></i>
      </div>
      <h3 class="empty-state-title">No players to display</h3>
      <p class="empty-state-description">There are no rankings for this mode yet.</p>
    </div>
    
    <div class="pagination">
      <button class="pagination-btn" :disabled="page === 0"
        @click="if (page > 0) LoadLeaderboard(sort, mode, mods, -1)">
        <i class="fa-solid fa-chevron-left"></i>
      </button>
      <span style="padding: 0 1rem; font-weight: 600;">Page <% page + 1 %></span>
      <button class="pagination-btn" :disabled="page === (page + 1) || boards.length < 50"
        @click="if (boards.length == 50) LoadLeaderboard(sort, mode, mods, 1)">
        <i class="fa-solid fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<script src="/static/js/asserts/vue-flags.js"></script>
<script src="/static/js/pages/leaderboard.js"></script>
{% endblock %}

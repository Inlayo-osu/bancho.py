{% extends 'base.html' %}
{% block title %}Leaderboard{% endblock %}

{% block description %}Leaderboards on Inlayo{% endblock %}

{% block og_title %}Global Leaderboard | Inlayo{% endblock %}
{% block og_description %}Browse global player rankings and compete with the best osu! players on Inlayo{% endblock %}
{% block og_image %}https://{{ domain() }}/static/favicon/android-chrome-256x256.png{% endblock %}

{% block header %}
<script src="/static/js/asserts/vue.js"></script>
<script src="/static/js/asserts/vue-axios.js"></script>

<script>
  var mode = "{{ mode }}";
  var mods = "{{ mods }}";
  var sort = "{{ sort }}";
  var domain = "{{ domain() }}";
  var page = parseInt("{{ page }}");
</script>

<link rel="stylesheet" href="/static/css/pages/leaderboard.css" />
{% endblock %} {% block content %}
<div id="app" :class="(load ? 'load' : '')" style="zoom: 1.1">
  <div class="card mb-5">
    <div class="mode-selector">
      <button class="mode-btn" :class="{ 'active': mode === 'std' }" @click="LoadLeaderboard(sort, 'std', mods)">
        <i class="mode-icon mode-osu"></i><span> osu!</span>
      </button>
      <button class="mode-btn" :class="{ 'active': mode === 'taiko', 'disabled': mods === 'ap' }"
        @click="LoadLeaderboard(sort, 'taiko', mods)">
        <i class="mode-icon mode-taiko"></i><span> osu!taiko</span>
      </button>
      <button class="mode-btn" :class="{ 'active': mode === 'catch', 'disabled': mods === 'ap' }"
        @click="LoadLeaderboard(sort, 'catch', mods)">
        <i class="mode-icon mode-catch"></i><span> osu!catch</span>
      </button>
      <button class="mode-btn" :class="{ 'active': mode === 'mania', 'disabled': mods === 'ap' || mods === 'rx' }"
        @click="LoadLeaderboard(sort, 'mania', mods)">
        <i class="mode-icon mode-mania"></i><span> osu!mania</span>
      </button>
    </div>
    
    <div class="text-center py-4">
      <h1 class="text-3xl font-bold">Leaderboard</h1>
    </div>
    
    <div class="flex justify-between px-4 pb-4 gap-4">
      <div class="flex gap-2">
        <button class="btn" :class="sort === 'pp' ? 'btn-primary' : 'btn-secondary'"
          @click="LoadLeaderboard('pp', mode, mods)">PP</button>
        <button class="btn" :class="sort === 'score' ? 'btn-primary' : 'btn-secondary'"
          @click="LoadLeaderboard('score', mode, mods)">Score</button>
      </div>
      <div class="flex gap-2">
        <button class="btn" :class="mods === 'vn' ? 'btn-primary' : 'btn-secondary'"
          @click="LoadLeaderboard(sort, mode, 'vn')">Vanilla</button>
        <button class="btn" :class="{ 'btn-primary': mods === 'rx', 'btn-secondary': mods !== 'rx', 'disabled': mode === 'mania' }"
          @click="LoadLeaderboard(sort, mode, 'rx')">Relax</button>
        <button class="btn"
          :class="{ 'btn-primary': mods === 'ap', 'btn-secondary': mods !== 'ap', 'disabled': mode === 'taiko' || mode === 'catch' || mode === 'mania' }"
          @click="LoadLeaderboard(sort, mode, 'ap')">Autopilot</button>
      </div>
    </div>
  </div>
  <div class="card">
    <div v-if="boards.length != undefined && boards.length != 0" class="leaderboard-table">
      <div class="leaderboard-header">
        <div>#</div>
        <div>Player</div>
        <div v-if="sort == 'pp' || sort == 'score'">
          <% (sort=='pp' ? "PP" : "Score" ) %>
        </div>
        <div>Accuracy</div>
        <div>Playcount</div>
        <div>Max Combo</div>
      </div>
      <a v-for="(user, index) in boards" :href="'/u/'+user.player_id+'?mode='+mode+'&mods='+mods" class="leaderboard-row">
        <div class="leaderboard-rank" :style="(page > 0) ? 'color: #fff !important' : ''">
          #<% (page * 50) + index + 1 %>
        </div>
        <div class="leaderboard-player">
          <div class="leaderboard-flag"
            :style="'background-image: url(/static/images/flags/' + user.country.toUpperCase() + '.png)'"
            :title="flags[user.country.toUpperCase()]">
          </div>
          <div class="leaderboard-avatar"
            :style="'background-image: url(https://a.{{ domain() }}/' + user.player_id + ')'"></div>
          <div class="leaderboard-name">
            <% user.clan_tag ? `[${user.clan_tag}] ${user.name}` : user.name %>
          </div>
        </div>
        <div v-if="sort == 'pp' || sort == 'score'">
          <% (sort=='pp' ? user.pp+'pp' : scoreFormat(user.rscore) ) %>
        </div>
        <div>
          <% user.acc.toFixed(2) %>%
        </div>
        <div>
          <% addCommas(user.plays) %>
        </div>
        <div>
          <% addCommas(user.max_combo) %>
        </div>
      </a>
    </div>
    <div v-else class="empty-state">
      <div class="empty-state-icon">
        <i class="fas fa-users"></i>
      </div>
      <h3 class="empty-state-title">No players to display</h3>
      <p class="empty-state-description">There are no rankings for this mode yet.</p>
    </div>
    
    <div class="pagination">
      <button class="pagination-btn" :disabled="page === 0"
        @click="if (page > 0) LoadLeaderboard(sort, mode, mods, -1)">
        <i class="fa-solid fa-chevron-left"></i>
      </button>
      <span class="px-4 font-semibold">Page <% page + 1 %></span>
      <button class="pagination-btn" :disabled="page === (page + 1) || boards.length < 50"
        @click="if (boards.length == 50) LoadLeaderboard(sort, mode, mods, 1)">
        <i class="fa-solid fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<script src="/static/js/asserts/vue-flags.js"></script>
<script src="/static/js/pages/leaderboard.js"></script>
{% endblock %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<nav id="navbar" class="navbar is-primary">
  <div class="container">
    <div class="navbar-brand">
      <a role="button" class="navbar-burger" id="navbar-burger" onclick="togglenavbar()">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/home">Home</a>
        <a class="navbar-item" href="/leaderboard">Leaderboards</a>
        <a class="navbar-item" href="/topplays">Top Plays</a>
        <!-- <a class="navbar-item" href="/clansettings">Clans</a> -->
        <!-- <a class="navbar-item" href="/rules">Rules</a> -->
        <div class="navbar-item has-dropdown">
          <a class="navbar-link"> Informations </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="/github" target="_blank">GitHub</a>
            <a class="navbar-item" href="/discord" target="_blank">Discord</a>
            <a class="navbar-item" href="/howtoconnect">How to Connect</a>
          </div>
        </div>
        <!-- {% if session.authenticated %}
        <div class="navbar-item has-dropdown">
          <a class="navbar-link"> Clans </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="/clans">Clan Leaderboard</a>
            {% if session.clan_data["id"] %}
            <a class="navbar-item" href="/settings/clansettings">Clan Settings</a>
            {% else %}
            <a class="navbar-item" href="/clans/create">Create Clan</a>
            {% endif %}
          </div>
        </div>
        {% endif %} -->
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="search-bar">
          <input id="search-txt" type="text" placeholder="Search" />
          <button onclick="search()">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
          <script src="/static/js/search.js"></script>
        </div>
        <div id="search-results" class="search-results"></div>
      </div>
      {% if session.authenticated %}
      <div class="navbar-item has-dropdown" style="zoom: 1.1">
        <a class="navbar-link">
          <div class="navbar-avatar"
            style="background: url(https://a.{{ domain() }}/{{ session.user_data['id'] }}); background-size: cover; background-position: 50%;">
          </div>
          {{ session.user_data['name'] }}
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="/u/{{ session.user_data['id'] }}">
            Profile
          </a>
          <a class="navbar-item" href="/settings"> Settings</a>
          {% if session.authenticated and session.user_data['is_staff'] %}
          <a class="navbar-item" href="/admin"> Management</a>
          {% endif %}
          <hr class="navbar-divider" />
          <a class="navbar-item" href="/logout"> Logout</a>
        </div>
      </div>
      {% else %}
      <div class="navbar-item" style="zoom: 1.1">
        <div class="buttons">
          <a class="button is-primary" href="/register">
            <strong>Sign up</strong>
          </a>
          <a class="button is-light" href="/login"> Log in </a>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</nav>

<style>
  /* Only animate background color, prevent all layout shifts */
  .navbar-item, .navbar-link, .navbar-dropdown .navbar-item {
    transition: background-color 0.2s ease !important;
  }
  
  .navbar-item:hover, .navbar-link:hover, .navbar-dropdown .navbar-item:hover {
    transform: none !important;
    padding: 0.5rem 0.75rem !important;
    margin: 0 !important;
  }
  
  .navbar-dropdown .navbar-item {
    padding: 0.375rem 1rem !important;
  }
  
  .navbar-dropdown .navbar-item:hover {
    padding: 0.375rem 1rem !important;
  }
</style>

<script>
  // Click-only dropdown toggle
  document.addEventListener('DOMContentLoaded', () => {
    const dropdowns = document.querySelectorAll('.navbar-item.has-dropdown');
    
    dropdowns.forEach(dropdown => {
      const link = dropdown.querySelector('.navbar-link');
      
      // Only respond to clicks, not hover
      link.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        // Close other dropdowns
        dropdowns.forEach(other => {
          if (other !== dropdown) {
            other.classList.remove('is-active');
          }
        });
        
        // Toggle current dropdown
        dropdown.classList.toggle('is-active');
      });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.navbar-item.has-dropdown')) {
        dropdowns.forEach(dropdown => {
          dropdown.classList.remove('is-active');
        });
      }
    });
  });
</script>
